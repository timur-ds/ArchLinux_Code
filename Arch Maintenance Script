#!/bin/bash
# ------------------------------------------------------------------------------
# –°–∫—Ä–∏–ø—Ç: arch_maintenance.sh
# –í–µ—Ä—Å–∏—è: 4.3
# ------------------------------------------------------------------------------
# –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:
#   –ö–æ–º–ø–ª–µ–∫—Å–Ω–æ–µ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ Arch Linux —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–º –∞—É–¥–∏—Ç–æ–º, –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º –∏
#   —É–ª—É—á—à–µ–Ω–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫. –û—Å–Ω–æ–≤–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:
#     - –ü–æ–ª–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã –∏ AUR-–ø–∞–∫–µ—Ç–æ–≤
#     - –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –∏ –¥—Ä–∞–π–≤–µ—Ä–æ–≤
#     - –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —ç–Ω–µ—Ä–≥–æ—Å–±–µ—Ä–µ–∂–µ–Ω–∏—è (TLP) –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–æ–∫ zram-generator
#     - –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–æ–≤, –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ Btrfs, –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–ª—é—á–µ–π –∏ –æ—á–∏—Å—Ç–∫–∞ –∫–µ—à–∞
#     - –ê–ø–ø–∞—Ä–∞—Ç–Ω—ã–π –∏ –ø—Ä–æ–≥—Ä–∞–º–º–Ω—ã–π –∞—É–¥–∏—Ç —Å –ø—Ä–æ–≤–µ—Ä–∫–∞–º–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
#     - –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –∞—É–¥–∏—Ç, –≤–∫–ª—é—á–∞—é—â–∏–π:
#         ‚Ä¢ –ü—Ä–æ–≤–µ—Ä–∫—É —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ —Å–∏—Å—Ç–µ–º—ã
#         ‚Ä¢ –ü–æ–∏—Å–∫ —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π —è–¥—Ä–∞
#         ‚Ä¢ –ü–æ–∏—Å–∫ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤, –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ –∏ –ø–∞–∫–µ—Ç–æ–≤
#         ‚Ä¢ –ü—Ä–æ–≤–µ—Ä–∫—É –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã—Ö —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π, –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è, cron‚Äë–∑–∞–¥–∞–Ω–∏–π
#         ‚Ä¢ –ê—É–¥–∏—Ç —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π, SSH, firewall, SELinux, AppArmor, PAM,
#           GRUB, sysctl, systemd, journald, logrotate, syslog, auditd, fail2ban, ufw
#         ‚Ä¢ –°–±–æ—Ä –ø–æ–¥—Ä–æ–±–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –∂–µ–ª–µ–∑–µ: CPU, GPU, –º–æ–Ω–∏—Ç–æ—Ä—ã, RAM, –¥–∏—Å–∫–∏,
#           —Å–µ—Ç–µ–≤–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è, –º–∞—Ç–µ—Ä–∏–Ω—Å–∫–∞—è –ø–ª–∞—Ç–∞, BIOS/UEFI, USB-—É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞, —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞,
#           –±–∞—Ç–∞—Ä–µ—è (–¥–ª—è –Ω–æ—É—Ç–±—É–∫–æ–≤)
#         ‚Ä¢ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é lynis‚Äë–∞—É–¥–∏—Ç–∞ (–µ—Å–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω)
#     - –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π —Ä–µ–∂–∏–º (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
#     - –ü—Ä–æ–≤–µ—Ä–∫—É –¥–∏—Å—Ç—Ä–∏–±—É—Ç–∏–≤–∞
#     - –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ sudo‚Äë—Ç–æ–∫–µ–Ω–∞ –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
#     - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏—Ç–æ–≥–æ–≤–æ–≥–æ –æ—Ç—á—ë—Ç–∞ (–ª–æ–≥ + –∞—É–¥–∏—Ç) –≤ –æ–¥–∏–Ω TXT-—Ñ–∞–π–ª —Å –¥–∞—Ç–æ–π –∏ –≤—Ä–µ–º–µ–Ω–µ–º
#
# –ù–æ–≤–æ–≤–≤–µ–¥–µ–Ω–∏—è:
#   1. –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∏ –∞—É–¥–∏—Ç–∞ (–±–æ–ª–µ–µ 20 —Ñ—É–Ω–∫—Ü–∏–π)
#   2. –°–±–æ—Ä –¥–µ—Ç–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –∂–µ–ª–µ–∑–µ –ü–ö
#   3. –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π —Ä–µ–∂–∏–º –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è
#   4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∏—Å—Ç—Ä–∏–±—É—Ç–∏–≤–∞
#   5. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ sudo‚Äë—Ç–æ–∫–µ–Ω–∞ –≤ —Ñ–æ–Ω–µ
#   6. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ–ª–Ω–æ–≥–æ –æ—Ç—á—ë—Ç–∞ –≤ –æ–¥–∏–Ω TXT-—Ñ–∞–π–ª —Å –¥–∞—Ç–æ–π –∏ –≤—Ä–µ–º–µ–Ω–µ–º
#
set -eo pipefail

# –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
declare -r TIMESTAMP=$(date +%Y%m%d_%H%M%S)
declare -r LOGDIR="/var/log/arch_maintenance"
declare -r LOGFILE="${LOGDIR}/maintenance_${TIMESTAMP}.log"
declare -r AUDIT_REPORT="${LOGDIR}/audit_${TIMESTAMP}.txt"
declare -ri MAX_LOG_DAYS=30
declare -ra DIAG_PKGS=(
    "dmidecode" "smartmontools" "lm_sensors" 
    "usbutils" "pciutils" "audit" "bash-completion"
)

# –¶–≤–µ—Ç–∞ –¥–ª—è –≤—ã–≤–æ–¥–∞
declare -r RED='\033[0;31m'
declare -r GREEN='\033[0;32m'
declare -r YELLOW='\033[0;33m'
declare -r BLUE='\033[0;34m'
declare -r NC='\033[0m' # No Color

# –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è sudo-—Ç–æ–∫–µ–Ω–∞ –≤ —Ñ–æ–Ω–µ
refresh_sudo() {
    while true; do
        sudo -n true
        sleep 60
        kill -0 "$$" || exit
    done 2>/dev/null &
}

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
init_logging() {
    mkdir -p "$LOGDIR" || {
        echo -e "${RED}‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∫–∞—Ç–∞–ª–æ–≥–∞ –ª–æ–≥–æ–≤${NC}" >&2
        exit 1
    }
    exec > >(tee -a "$LOGFILE") 2> >(tee -a "$LOGFILE" >&2)
    # –†–æ—Ç–∞—Ü–∏—è –ª–æ–≥–æ–≤
    find "$LOGDIR" -name "*.log" -mtime +$MAX_LOG_DAYS -delete
    find "$LOGDIR" -name "*.txt" -mtime +$MAX_LOG_DAYS -delete
    echo -e "${BLUE}=== –ó–∞–ø—É—Å–∫ —Å–∫—Ä–∏–ø—Ç–∞: $(date) ===${NC}"
}

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ sudo
check_privileges() {
    if [[ $EUID -ne 0 ]]; then
        echo -e "${YELLOW}‚ö† –¢—Ä–µ–±—É—é—Ç—Å—è –ø—Ä–∞–≤–∞ root. –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ sudo...${NC}"
        exec sudo -u root "$0" "$@"
        exit 1
    fi
}

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–∞–∫–µ—Ç–æ–≤ —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫
install_packages() {
    local -a missing=()
    for pkg in "$@"; do
        pacman -Qi "$pkg" &>/dev/null || missing+=("$pkg")
    done
    if [[ ${#missing[@]} -gt 0 ]]; then
        echo -e "${BLUE}üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–∞–∫–µ—Ç–æ–≤: ${missing[*]}${NC}"
        if ! pacman -S --noconfirm --needed "${missing[@]}"; then
            echo -e "${RED}‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏: ${missing[*]}${NC}" >&2
            exit 1
        fi
    fi
}

# –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
backup_configs() {
    local -r backup_dir="${LOGDIR}/backups_${TIMESTAMP}"
    mkdir -p "$backup_dir"
    declare -a critical_files=(
        "/etc/pacman.d/mirrorlist"
        "/etc/pacman.conf"
        "/etc/default/grub"
    )
    echo -e "${BLUE}üíæ –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤...${NC}"
    for file in "${critical_files[@]}"; do
        if [[ -f "$file" ]]; then
            cp -v "$file" "$backup_dir" >> "$LOGFILE"
        fi
    done
}

# –ü–æ–ª–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã (—è–¥—Ä–æ, –ø–∞–∫–µ—Ç—ã, AUR)
system_upgrade() {
    echo -e "${BLUE}‚öôÔ∏è –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–µ—Ä–∫–∞–ª...${NC}"
    reflector --latest 20 --protocol https --sort rate --save /etc/pacman.d/mirrorlist
    echo -e "${BLUE}‚öôÔ∏è –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã (pacman -Syu)...${NC}"
    pacman -Syu --noconfirm
    if command -v yay &>/dev/null; then
        echo -e "${BLUE}‚öôÔ∏è –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ AUR (yay)...${NC}"
        sudo -u "${SUDO_USER:-$USER}" yay -Syu --devel --timeupdate --noconfirm
    fi
}

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –∏ –¥—Ä–∞–π–≤–µ—Ä–æ–≤
install_drivers_and_components() {
    echo -e "${BLUE}üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –∏ –¥—Ä–∞–π–≤–µ—Ä–æ–≤...${NC}"
    local -a packages=(
        "intel-media-driver" "mesa" "vulkan-intel"
        "xf86-input-wacom" "xf86-input-libinput"
        "linux-firmware" "bluez" "bluez-utils" "alsa-utils" "zram-generator"
    )
    if pacman -Qi pipewire-pulse &>/dev/null; then
        echo -e "${YELLOW}‚ö† –û–±–Ω–∞—Ä—É–∂–µ–Ω pipewire-pulse, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º —É—Å—Ç–∞–Ω–æ–≤–∫—É pulseaudio${NC}"
    else
        packages+=("pulseaudio")
    fi
    pacman -S --noconfirm --needed "${packages[@]}"
}

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ TLP (—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —ç–Ω–µ—Ä–≥–æ—Å–±–µ—Ä–µ–∂–µ–Ω–∏–µ–º)
configure_tlp() {
    echo -e "${BLUE}üîã –ù–∞—Å—Ç—Ä–æ–π–∫–∞ TLP...${NC}"
    systemctl enable tlp.service
    tlp setcharge 75 80 BAT0
}

# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–æ–∫ zram-generator
enable_zram() {
    echo -e "${BLUE}üíæ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–æ–∫ zram-generator...${NC}"
    systemctl enable systemd-zram-setup@zram0
}

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–æ–≤
restart_services() {
    echo -e "${BLUE}üîÑ –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–æ–≤ (ModemManager, bluetooth, tlp)...${NC}"
    systemctl restart ModemManager bluetooth tlp
}

# –ë–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ –∏ –¥–µ—Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞—Ü–∏—è Btrfs
btrfs_maintenance() {
    echo -e "${BLUE}üóúÔ∏è –ë–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ –∏ –¥–µ—Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞—Ü–∏—è Btrfs...${NC}"
    if btrfs balance start /; then
        if ! btrfs filesystem defragment -r /; then
            echo -e "${YELLOW}‚ö† –ù–µ–∫–æ—Ç–æ—Ä—ã–µ —Ñ–∞–π–ª—ã –Ω–µ —É–¥–∞–ª–æ—Å—å –¥–µ—Ñ—Ä–∞–≥–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å (–Ω–∞–ø—Ä–∏–º–µ—Ä, 'Text file busy'). –≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ –¥–ª—è –∑–∞–Ω—è—Ç—ã—Ö —Ñ–∞–π–ª–æ–≤, –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ.${NC}"
        fi
    else
        echo -e "${RED}‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–µ Btrfs. –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –æ–ø–µ—Ä–∞—Ü–∏—é –¥–µ—Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞—Ü–∏–∏.${NC}"
    fi
}

# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–ª—é—á–µ–π —Å–∏—Å—Ç–µ–º—ã
refresh_keys() {
    echo -e "${BLUE}üîë –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–ª—é—á–µ–π —Å–∏—Å—Ç–µ–º—ã...${NC}"
    pacman-key --refresh-keys
}

# –û—á–∏—Å—Ç–∫–∞ –∫–µ—à–∞ pacman (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –æ—Ç–≤–µ—Ç –Ω–∞ –∑–∞–ø—Ä–æ—Å—ã)
clean_cache() {
    echo -e "${BLUE}üßπ –û—á–∏—Å—Ç–∫–∞ –∫–µ—à–∞ pacman (pacman -Sc)...${NC}"
    yes | pacman -Sc --noconfirm
}

# –í—ã–≤–æ–¥ —Å–æ–æ–±—â–µ–Ω–∏—è –æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏
reboot_message() {
    echo -e "${YELLOW}‚ÑπÔ∏è –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ —Å–∏—Å—Ç–µ–º—É: sudo reboot${NC}"
}

# –§—É–Ω–∫—Ü–∏—è, –æ–±—ä–µ–¥–∏–Ω—è—é—â–∞—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è
extra_update_maintenance() {
    install_drivers_and_components
    configure_tlp
    enable_zram
    restart_services
    btrfs_maintenance
    refresh_keys
    clean_cache
    reboot_message
}

# –£–º–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ —Å–∏—Å—Ç–µ–º—ã (–∫–µ—à–∏, Docker, –∂—É—Ä–Ω–∞–ª—ã)
clean_system() {
    echo -e "${BLUE}üßπ –û—á–∏—Å—Ç–∫–∞ –∫–µ—à–∞ pacman (paccache)...${NC}"
    paccache -rk5
    echo -e "${BLUE}üßπ –û—á–∏—Å—Ç–∫–∞ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –∂—É—Ä–Ω–∞–ª–æ–≤...${NC}"
    journalctl --vacuum-time=4weeks
    echo -e "${BLUE}üßπ –û—á–∏—Å—Ç–∫–∞ –∫–µ—à–∞ yay...${NC}"
    rm -rf /var/cache/yay/*
    if command -v docker &>/dev/null; then
        echo -e "${BLUE}üê≥ –ê–Ω–∞–ª–∏–∑ Docker...${NC}"
        local -ri running_containers
        running_containers=$(docker ps -q | wc -l)
        if [[ $running_containers -gt 0 ]]; then
            echo -e "${YELLOW}‚ö† –û–±–Ω–∞—Ä—É–∂–µ–Ω—ã –∑–∞–ø—É—â–µ–Ω–Ω—ã–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã:${NC}"
            docker ps --format "table {{.ID}}\t{{.Names}}\t{{.Status}}"
            read -rp "–ü—Ä–µ—Ä–≤–∞—Ç—å –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ? [y/N] " answer
            if [[ $answer =~ [Yy] ]]; then
                echo -e "${RED}‚ùå –û–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ –ø—Ä–µ—Ä–≤–∞–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º${NC}"
                exit 1
            fi
        fi
        echo -e "${BLUE}üßπ –û—á–∏—Å—Ç–∫–∞ Docker...${NC}"
        docker system prune -af --volumes
    fi
}

# –ê–ø–ø–∞—Ä–∞—Ç–Ω—ã–π –∞—É–¥–∏—Ç
hardware_audit() {
    echo -e "${BLUE}üîç –ê–ø–ø–∞—Ä–∞—Ç–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞...${NC}"
    sensors-detect --auto >/dev/null 2>&1
    {
        echo -e "=== –ê–ø–ø–∞—Ä–∞—Ç–Ω—ã–π –∞—É–¥–∏—Ç ===\n"
        echo -e "‚óè –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–∞–º—è—Ç–∏:\n$(dmidecode -t memory)"
        echo -e "\n‚óè –°–æ—Å—Ç–æ—è–Ω–∏–µ –Ω–∞–∫–æ–ø–∏—Ç–µ–ª–µ–π:"
        smartctl --scan | awk '{print $1}' | xargs -I{} sh -c '
            echo -e "\n‚ñ≤ –£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ: $1"; 
            smartctl -a "$1"
        ' _ {}
    } >> "$AUDIT_REPORT"
}

# –£–ª—É—á—à–µ–Ω–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
security_check() {
    echo -e "${BLUE}üîí –ê–Ω–∞–ª–∏–∑ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏...${NC}"
    {
        echo -e "=== –û—Ç—á–µ—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ ===\n"
        echo -e "‚óè –ü—Ä–∏–≤–∏–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏:"
        awk -F: '$3 >= 1000 {print $1}' /etc/passwd
        echo -e "\n‚óè –ö—Ä–∏—Ç–∏—á–Ω—ã–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤:"
        find /etc -type f \( -perm -4000 -o -perm -2000 \) -exec ls -l {} \; 2>/dev/null
        if command -v auditctl &>/dev/null; then
            echo -e "\n‚óè –ü—Ä–∞–≤–∏–ª–∞ –∞—É–¥–∏—Ç–∞:\n$(auditctl -l)"
        else
            echo -e "\n‚óè Auditd –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω"
        fi
    } >> "$AUDIT_REPORT"
}

# –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –∞—É–¥–∏—Ç: —Å–µ—Ç—å, —Å—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã, fwupd, –æ—Å–∏—Ä–æ—Ç–µ–≤—à–∏–µ –ø–∞–∫–µ—Ç—ã
network_audit() {
    echo -e "${BLUE}üîç –°–µ—Ç–µ–≤–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞...${NC}"
    {
        echo -e "\n=== –°–µ—Ç–µ–≤–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ ===\n"
        echo "‚óè –ê–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è (ss -tulpn):"
        ss -tulpn
        echo -e "\n‚óè –°–æ—Å—Ç–æ—è–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤ (ip a):"
        ip a
        echo -e "\n‚óè –ü–∏–Ω–≥ –¥–æ google.com:"
        ping -c 3 google.com
    } >> "$AUDIT_REPORT"
}

system_status() {
    echo -e "${BLUE}üîç –°—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã...${NC}"
    {
        echo -e "\n=== –°—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã ===\n"
        echo "‚óè Uptime:"
        uptime
        echo -e "\n‚óè –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏ (free -h):"
        free -h
        echo -e "\n‚óè –ü—Ä–æ–≤–∞–ª–µ–Ω–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã (systemctl --failed):"
        systemctl --failed || echo "–ù–µ—Ç –ø—Ä–æ–≤–∞–ª–µ–Ω–Ω—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤"
    } >> "$AUDIT_REPORT"
}

fw_update_check() {
    if command -v fwupdmgr &>/dev/null; then
        echo -e "${BLUE}üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –ø—Ä–æ—à–∏–≤–æ–∫...${NC}"
        {
            echo -e "\n=== –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –ø—Ä–æ—à–∏–≤–æ–∫ (fwupd) ===\n"
            fwupdmgr refresh
            fwupdmgr get-updates
        } >> "$AUDIT_REPORT"
    else
        echo -e "${YELLOW}‚ö† fwupdmgr –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É –ø—Ä–æ—à–∏–≤–æ–∫${NC}" >> "$AUDIT_REPORT"
    fi
}

orphan_packages() {
    echo -e "${BLUE}üîç –ü–æ–∏—Å–∫ –æ—Å–∏—Ä–æ—Ç–µ–≤—à–∏—Ö –ø–∞–∫–µ—Ç–æ–≤...${NC}"
    {
        echo -e "\n=== –û—Å–∏—Ä–æ—Ç–µ–≤—à–∏–µ –ø–∞–∫–µ—Ç—ã ===\n"
        pacman -Qtdq || echo "–ù–µ—Ç –æ—Å–∏—Ä–æ—Ç–µ–≤—à–∏—Ö –ø–∞–∫–µ—Ç–æ–≤"
    } >> "$AUDIT_REPORT"
}

# –ù–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∞—É–¥–∏—Ç–∞ –¥–ª—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –∂–µ–ª–µ–∑–µ –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è—Ö

# 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
check_obsolete_configs() {
    echo -e "${BLUE}üîç –ü–æ–∏—Å–∫ —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤...${NC}"
    {
        echo -e "\n=== –£—Å—Ç–∞—Ä–µ–≤—à–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã ===\n"
        pacman -Qdt || echo "–£—Å—Ç–∞—Ä–µ–≤—à–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω—ã"
    } >> "$AUDIT_REPORT"
}

# 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã—Ö SSH-–∫–ª—é—á–µ–π
check_unsafe_ssh_keys() {
    echo -e "${BLUE}üîç –ü–æ–∏—Å–∫ –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã—Ö SSH-–∫–ª—é—á–µ–π...${NC}"
    {
        echo -e "\n=== –ù–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã–µ SSH-–∫–ª—é—á–∏ ===\n"
        find /etc/ssh -name "*.pub" -exec ssh-keygen -l -f {} \; | grep -E "(1024|2048)" || echo "–ù–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã–µ SSH-–∫–ª—é—á–∏ –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω—ã"
    } >> "$AUDIT_REPORT"
}

# 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫ SSH
check_unsafe_ssh_config() {
    echo -e "${BLUE}üîç –ü–æ–∏—Å–∫ –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫ SSH...${NC}"
    {
        echo -e "\n=== –ù–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ SSH ===\n"
        grep -Ei "(PermitRootLogin yes|Protocol 1)" /etc/ssh/sshd_config || echo "–ù–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ SSH –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω—ã"
    } >> "$AUDIT_REPORT"
}

# 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã—Ö —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π –¥–ª—è –∫–∞—Ç–∞–ª–æ–≥–æ–≤
check_unsafe_directory_permissions() {
    echo -e "${BLUE}üîç –ü–æ–∏—Å–∫ –∫–∞—Ç–∞–ª–æ–≥–æ–≤ —Å –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã–º–∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è–º–∏...${NC}"
    {
        echo -e "\n=== –ö–∞—Ç–∞–ª–æ–≥–∏ —Å –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã–º–∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è–º–∏ ===\n"
        find / -xdev -type d -perm -o+w -exec ls -ld {} \; 2>/dev/null || echo "–ö–∞—Ç–∞–ª–æ–≥–∏ —Å –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã–º–∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è–º–∏ –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω—ã"
    } >> "$AUDIT_REPORT"
}

# 5. –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫ sudoers
check_unsafe_sudoers() {
    echo -e "${BLUE}üîç –ü–æ–∏—Å–∫ –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫ sudoers...${NC}"
    {
        echo -e "\n=== –ù–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ sudoers ===\n"
        grep -Ei "(NOPASSWD|!authenticate)" /etc/sudoers || echo "–ù–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ sudoers –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω—ã"
    } >> "$AUDIT_REPORT"
}

# 6. –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫ firewalld
check_unsafe_firewalld() {
    if command -v firewall-cmd &>/dev/null; then
        echo -e "${BLUE}üîç –ü–æ–∏—Å–∫ –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫ firewalld...${NC}"
        {
            echo -e "\n=== –ù–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ firewalld ===\n"
            firewall-cmd --list-all | grep -Ei "(open|allow)" || echo "–ù–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ firewalld –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω—ã"
        } >> "$AUDIT_REPORT"
    else
        echo -e "${YELLOW}‚ö† firewalld –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É –Ω–∞—Å—Ç—Ä–æ–µ–∫ firewalld${NC}" >> "$AUDIT_REPORT"
    fi
}

# 7. –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫ iptables
check_unsafe_iptables() {
    if command -v iptables &>/dev/null; then
        echo -e "${BLUE}üîç –ü–æ–∏—Å–∫ –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫ iptables...${NC}"
        {
            echo -e "\n=== –ù–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ iptables ===\n"
            iptables -L -n -v | grep -Ei "(ACCEPT|open)" || echo "–ù–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ iptables –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω—ã"
        } >> "$AUDIT_REPORT"
    else
        echo -e "${YELLOW}‚ö† iptables –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É –Ω–∞—Å—Ç—Ä–æ–µ–∫ iptables${NC}" >> "$AUDIT_REPORT"
    fi
}

# 8. –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫ SELinux
check_unsafe_selinux() {
    if command -v sestatus &>/dev/null; then
        echo -e "${BLUE}üîç –ü–æ–∏—Å–∫ –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫ SELinux...${NC}"
        {
            echo -e "\n=== –ù–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ SELinux ===\n"
            sestatus | grep -Ei "(disabled|permissive)" || echo "–ù–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ SELinux –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω—ã"
        } >> "$AUDIT_REPORT"
    else
        echo -e "${YELLOW}‚ö† SELinux –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É –Ω–∞—Å—Ç—Ä–æ–µ–∫ SELinux${NC}" >> "$AUDIT_REPORT"
    fi
}

# 9. –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫ AppArmor
check_unsafe_apparmor() {
    if command -v aa-status &>/dev/null; then
        echo -e "${BLUE}üîç –ü–æ–∏—Å–∫ –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫ AppArmor...${NC}"
        {
            echo -e "\n=== –ù–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ AppArmor ===\n"
            aa-status | grep -Ei "(disabled|inactive)" || echo "–ù–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ AppArmor –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω—ã"
        } >> "$AUDIT_REPORT"
    else
        echo -e "${YELLOW}‚ö† AppArmor –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É –Ω–∞—Å—Ç—Ä–æ–µ–∫ AppArmor${NC}" >> "$AUDIT_REPORT"
    fi
}

# 10. –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫ PAM
check_unsafe_pam() {
    echo -e "${BLUE}üîç –ü–æ–∏—Å–∫ –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫ PAM...${NC}"
    {
        echo -e "\n=== –ù–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ PAM ===\n"
        grep -Ei "(password.*pam_unix.so.*nullok|auth.*pam_tally2.so)" /etc/pam.d/* || echo "–ù–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ PAM –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω—ã"
    } >> "$AUDIT_REPORT"
}

# 11. –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫ GRUB
check_unsafe_grub() {
    echo -e "${BLUE}üîç –ü–æ–∏—Å–∫ –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫ GRUB...${NC}"
    {
        echo -e "\n=== –ù–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ GRUB ===\n"
        grep -Ei "(password|single)" /etc/default/grub || echo "–ù–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ GRUB –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω—ã"
    } >> "$AUDIT_REPORT"
}

# 12. –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫ sysctl
check_unsafe_sysctl() {
    echo -e "${BLUE}üîç –ü–æ–∏—Å–∫ –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫ sysctl...${NC}"
    {
        echo -e "\n=== –ù–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ sysctl ===\n"
        sysctl -a | grep -Ei "(net.ipv4.conf.all.rp_filter|net.ipv4.ip_forward)" || echo "–ù–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ sysctl –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω—ã"
    } >> "$AUDIT_REPORT"
}

# 13. –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫ systemd
check_unsafe_systemd() {
    echo -e "${BLUE}üîç –ü–æ–∏—Å–∫ –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫ systemd...${NC}"
    {
        echo -e "\n=== –ù–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ systemd ===\n"
        systemctl list-unit-files --state=enabled | grep -Ei "(root|unrestricted)" || echo "–ù–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ systemd –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω—ã"
    } >> "$AUDIT_REPORT"
}

# 14. –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫ journald
check_unsafe_journald() {
    echo -e "${BLUE}üîç –ü–æ–∏—Å–∫ –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫ journald...${NC}"
    {
        echo -e "\n=== –ù–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ journald ===\n"
        grep -Ei "(Storage|Compress)" /etc/systemd/journald.conf || echo "–ù–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ journald –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω—ã"
    } >> "$AUDIT_REPORT"
}

# 15. –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫ logrotate
check_unsafe_logrotate() {
    echo -e "${BLUE}üîç –ü–æ–∏—Å–∫ –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫ logrotate...${NC}"
    {
        echo -e "\n=== –ù–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ logrotate ===\n"
        grep -Ei "(compress|size)" /etc/logrotate.conf || echo "–ù–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ logrotate –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω—ã"
    } >> "$AUDIT_REPORT"
}

# 16. –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫ cron
check_unsafe_cron() {
    echo -e "${BLUE}üîç –ü–æ–∏—Å–∫ –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫ cron...${NC}"
    {
        echo -e "\n=== –ù–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ cron ===\n"
        grep -Ei "(PATH|MAILTO)" /etc/crontab || echo "–ù–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ cron –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω—ã"
    } >> "$AUDIT_REPORT"
}

# 17. –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫ syslog
check_unsafe_syslog() {
    echo -e "${BLUE}üîç –ü–æ–∏—Å–∫ –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫ syslog...${NC}"
    {
        echo -e "\n=== –ù–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ syslog ===\n"
        grep -Ei "(Compress|Size)" /etc/rsyslog.conf || echo "–ù–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ syslog –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω—ã"
    } >> "$AUDIT_REPORT"
}

# 18. –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫ auditd
check_unsafe_auditd() {
    if command -v auditctl &>/dev/null; then
        echo -e "${BLUE}üîç –ü–æ–∏—Å–∫ –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫ auditd...${NC}"
        {
            echo -e "\n=== –ù–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ auditd ===\n"
            auditctl -l | grep -Ei "(size|backlog)" || echo "–ù–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ auditd –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω—ã"
        } >> "$AUDIT_REPORT"
    else
        echo -e "${YELLOW}‚ö† auditd –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É –Ω–∞—Å—Ç—Ä–æ–µ–∫ auditd${NC}" >> "$AUDIT_REPORT"
    fi
}

# 19. –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫ fail2ban
check_unsafe_fail2ban() {
    if command -v fail2ban-client &>/dev/null; then
        echo -e "${BLUE}üîç –ü–æ–∏—Å–∫ –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫ fail2ban...${NC}"
        {
            echo -e "\n=== –ù–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ fail2ban ===\n"
            fail2ban-client status | grep -Ei "(jail|ban)" || echo "–ù–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ fail2ban –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω—ã"
        } >> "$AUDIT_REPORT"
    else
        echo -e "${YELLOW}‚ö† fail2ban –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É –Ω–∞—Å—Ç—Ä–æ–µ–∫ fail2ban${NC}" >> "$AUDIT_REPORT"
    fi
}

# 20. –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫ ufw
check_unsafe_ufw() {
    if command -v ufw &>/dev/null; then
        echo -e "${BLUE}üîç –ü–æ–∏—Å–∫ –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫ ufw...${NC}"
        {
            echo -e "\n=== –ù–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ ufw ===\n"
            ufw status verbose | grep -Ei "(allow|deny)" || echo "–ù–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ ufw –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω—ã"
        } >> "$AUDIT_REPORT"
    else
        echo -e "${YELLOW}‚ö† ufw –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É –Ω–∞—Å—Ç—Ä–æ–µ–∫ ufw${NC}" >> "$AUDIT_REPORT"
    fi
}

# –ù–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Å–±–æ—Ä–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –∂–µ–ª–µ–∑–µ:

# 21. –°–±–æ—Ä –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–µ
check_cpu_info() {
    echo -e "${BLUE}üîç –°–±–æ—Ä –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–µ...${NC}"
    {
        echo -e "\n=== –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–µ ===\n"
        lscpu
    } >> "$AUDIT_REPORT"
}

# 22. –°–±–æ—Ä –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ GPU
check_gpu_info() {
    echo -e "${BLUE}üîç –°–±–æ—Ä –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ GPU...${NC}"
    {
        echo -e "\n=== –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ GPU ===\n"
        echo "‚óè –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ GPU:"
        lspci | grep -i vga
        echo -e "\n‚óè –î–∏—Å–∫—Ä–µ—Ç–Ω—ã–µ GPU:"
        lspci | grep -i 3d
        if command -v nvidia-smi &>/dev/null; then
            echo -e "\n‚óè –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ NVIDIA GPU:"
            nvidia-smi
        else
            echo -e "\n‚óè NVIDIA GPU –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω—ã –∏–ª–∏ –¥—Ä–∞–π–≤–µ—Ä—ã –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã."
        fi
    } >> "$AUDIT_REPORT"
}

# 23. –°–±–æ—Ä –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –º–æ–Ω–∏—Ç–æ—Ä–∞—Ö
check_monitor_info() {
    echo -e "${BLUE}üîç –°–±–æ—Ä –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –º–æ–Ω–∏—Ç–æ—Ä–∞—Ö...${NC}"
    {
        echo -e "\n=== –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –º–æ–Ω–∏—Ç–æ—Ä–∞—Ö ===\n"
        if command -v xrandr &>/dev/null; then
            echo "‚óè –ü–æ–¥–∫–ª—é—á–µ–Ω–Ω—ã–µ –º–æ–Ω–∏—Ç–æ—Ä—ã (xrandr):"
            xrandr --listmonitors
        else
            echo "‚óè xrandr –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º —Å–±–æ—Ä –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –º–æ–Ω–∏—Ç–æ—Ä–∞—Ö."
        fi
        if command -v edid-decode &>/dev/null; then
            echo -e "\n‚óè EDID-–¥–∞–Ω–Ω—ã–µ –º–æ–Ω–∏—Ç–æ—Ä–æ–≤:"
            for edid in /sys/class/drm/*/edid; do
                if [[ -f "$edid" ]]; then
                    echo "‚ñ≤ –£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ: $(basename "$(dirname "$edid")")"
                    edid-decode "$edid"
                fi
            done
        else
            echo -e "\n‚óè edid-decode –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –∞–Ω–∞–ª–∏–∑ EDID."
        fi
    } >> "$AUDIT_REPORT"
}

# 24. –°–±–æ—Ä –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–∞–º—è—Ç–∏ (RAM)
check_memory_info() {
    echo -e "${BLUE}üîç –°–±–æ—Ä –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–∞–º—è—Ç–∏ (RAM)...${NC}"
    {
        echo -e "\n=== –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–∞–º—è—Ç–∏ (RAM) ===\n"
        echo "‚óè –û–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è (free):"
        free -h
        echo -e "\n‚óè –î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è (dmidecode):"
        dmidecode -t memory | grep -E "(Size:|Type:|Speed:)"
    } >> "$AUDIT_REPORT"
}

# 25. –°–±–æ—Ä –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –¥–∏—Å–∫–∞—Ö
check_disk_info() {
    echo -e "${BLUE}üîç –°–±–æ—Ä –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –¥–∏—Å–∫–∞—Ö...${NC}"
    {
        echo -e "\n=== –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –¥–∏—Å–∫–∞—Ö ===\n"
        echo "‚óè –°–ø–∏—Å–æ–∫ –¥–∏—Å–∫–æ–≤ (lsblk):"
        lsblk -o NAME,SIZE,TYPE,MOUNTPOINT,FSTYPE
        echo -e "\n‚óè –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ä–∞–∑–¥–µ–ª–∞—Ö (fdisk):"
        fdisk -l
        echo -e "\n‚óè –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ (hdparm):"
        for disk in $(lsblk -d -o NAME -n); do
            echo "‚ñ≤ –£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ: /dev/$disk"
            hdparm -I /dev/$disk | grep -E "(Model|Speed|Rotation Rate)"
        done
    } >> "$AUDIT_REPORT"
}

# 26. –°–±–æ—Ä –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Å–µ—Ç–µ–≤—ã—Ö –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞—Ö
check_network_info() {
    echo -e "${BLUE}üîç –°–±–æ—Ä –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Å–µ—Ç–µ–≤—ã—Ö –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞—Ö...${NC}"
    {
        echo -e "\n=== –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–µ—Ç–µ–≤—ã—Ö –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞—Ö ===\n"
        echo "‚óè –°–ø–∏—Å–æ–∫ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤ (ip):"
        ip a
        echo -e "\n‚óè –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–∫–æ—Ä–æ—Å—Ç–∏ –∏ –¥—É–ø–ª–µ–∫—Å–µ (ethtool):"
        for iface in $(ip -o link show | awk -F': ' '{print $2}'); do
            echo "‚ñ≤ –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å: $iface"
            ethtool "$iface" | grep -E "(Speed|Duplex)" || echo "–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è $iface"
        done
    } >> "$AUDIT_REPORT"
}

# 27. –°–±–æ—Ä –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –º–∞—Ç–µ—Ä–∏–Ω—Å–∫–æ–π –ø–ª–∞—Ç–µ
check_motherboard_info() {
    echo -e "${BLUE}üîç –°–±–æ—Ä –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –º–∞—Ç–µ—Ä–∏–Ω—Å–∫–æ–π –ø–ª–∞—Ç–µ...${NC}"
    {
        echo -e "\n=== –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –º–∞—Ç–µ—Ä–∏–Ω—Å–∫–æ–π –ø–ª–∞—Ç–µ ===\n"
        dmidecode -t baseboard
    } >> "$AUDIT_REPORT"
}

# 28. –°–±–æ—Ä –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ BIOS/UEFI
check_bios_info() {
    echo -e "${BLUE}üîç –°–±–æ—Ä –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ BIOS/UEFI...${NC}"
    {
        echo -e "\n=== –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ BIOS/UEFI ===\n"
        dmidecode -t bios
    } >> "$AUDIT_REPORT"
}

# 29. –°–±–æ—Ä –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ USB-—É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö
check_usb_info() {
    echo -e "${BLUE}üîç –°–±–æ—Ä –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ USB-—É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö...${NC}"
    {
        echo -e "\n=== –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ USB-—É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö ===\n"
        lsusb
    } >> "$AUDIT_REPORT"
}

# 30. –°–±–æ—Ä –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–µ –∏ –≤–µ–Ω—Ç–∏–ª—è—Ç–æ—Ä–∞—Ö
check_temperature_info() {
    echo -e "${BLUE}üîç –°–±–æ—Ä –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–µ –∏ –≤–µ–Ω—Ç–∏–ª—è—Ç–æ—Ä–∞—Ö...${NC}"
    {
        echo -e "\n=== –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–µ –∏ –≤–µ–Ω—Ç–∏–ª—è—Ç–æ—Ä–∞—Ö ===\n"
        sensors
    } >> "$AUDIT_REPORT"
}

# 31. –°–±–æ—Ä –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –±–∞—Ç–∞—Ä–µ–µ (–¥–ª—è –Ω–æ—É—Ç–±—É–∫–æ–≤)
check_battery_info() {
    echo -e "${BLUE}üîç –°–±–æ—Ä –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –±–∞—Ç–∞—Ä–µ–µ...${NC}"
    {
        echo -e "\n=== –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –±–∞—Ç–∞—Ä–µ–µ ===\n"
        if command -v upower &>/dev/null; then
            upower -i $(upower -e | grep battery)
        else
            echo "‚óè upower –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º —Å–±–æ—Ä –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –±–∞—Ç–∞—Ä–µ–µ."
        fi
    } >> "$AUDIT_REPORT"
}

# –§—É–Ω–∫—Ü–∏—è —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–≥–æ –∞—É–¥–∏—Ç–∞, –æ–±—ä–µ–¥–∏–Ω—è—é—â–∞—è –≤—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏
extended_audit() {
    check_system_integrity
    check_kernel_vulnerabilities
    check_kernel_updates
    check_suspicious_processes
    check_unused_services
    check_unsafe_permissions
    check_obsolete_packages
    check_unused_packages
    check_unsafe_env_vars
    check_unsafe_cron_jobs
    run_lynis_audit
    network_audit
    system_status
    fw_update_check
    orphan_packages

    # –°—Ç–∞—Ä—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏
    check_obsolete_configs
    check_unsafe_ssh_keys
    check_unsafe_ssh_config
    check_unsafe_directory_permissions
    check_unsafe_sudoers
    check_unsafe_firewalld
    check_unsafe_iptables
    check_unsafe_selinux
    check_unsafe_apparmor
    check_unsafe_pam
    check_unsafe_grub
    check_unsafe_sysctl
    check_unsafe_systemd
    check_unsafe_journald
    check_unsafe_logrotate
    check_unsafe_cron
    check_unsafe_syslog
    check_unsafe_auditd
    check_unsafe_fail2ban
    check_unsafe_ufw

    # –ù–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Å–±–æ—Ä–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –∂–µ–ª–µ–∑–µ
    check_cpu_info
    check_gpu_info
    check_monitor_info
    check_memory_info
    check_disk_info
    check_network_info
    check_motherboard_info
    check_bios_info
    check_usb_info
    check_temperature_info
    check_battery_info
}

# –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∞—É–¥–∏—Ç–∞ –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–µ–π –≤–µ—Ä—Å–∏–∏:
check_system_integrity() {
    echo -e "${BLUE}üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ —Å–∏—Å—Ç–µ–º—ã...${NC}"
    {
        echo -e "\n=== –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ —Å–∏—Å—Ç–µ–º—ã ===\n"
        pacman -Qkk | grep -v " 0 errors" || echo "–ù–µ—Ç –æ—à–∏–±–æ–∫ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏"
    } >> "$AUDIT_REPORT"
}

check_kernel_vulnerabilities() {
    if command -v lynis &>/dev/null; then
        echo -e "${BLUE}üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π —è–¥—Ä–∞ (lynis)...${NC}"
        {
            echo -e "\n=== –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π —è–¥—Ä–∞ ===\n"
            lynis audit system --quick --no-colors | grep -i "kernel"
        } >> "$AUDIT_REPORT"
    else
        echo -e "${YELLOW}‚ö† lynis –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π —è–¥—Ä–∞${NC}" >> "$AUDIT_REPORT"
    fi
}

check_kernel_updates() {
    echo -e "${BLUE}üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π —è–¥—Ä–∞...${NC}"
    {
        echo -e "\n=== –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π —è–¥—Ä–∞ ===\n"
        pacman -Qs linux | grep "linux " 
        echo -e "\n‚óè –î–æ—Å—Ç—É–ø–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —è–¥—Ä–∞:"
        pacman -Sy --print-format "%n %v" linux | grep "linux "
    } >> "$AUDIT_REPORT"
}

check_suspicious_processes() {
    echo -e "${BLUE}üîç –ü–æ–∏—Å–∫ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤...${NC}"
    {
        echo -e "\n=== –ü–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ—Ü–µ—Å—Å—ã ===\n"
        ps aux | grep -Ei "(cryptominer|malware|backdoor|exploit)" || echo "–ü–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ—Ü–µ—Å—Å—ã –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω—ã"
    } >> "$AUDIT_REPORT"
}

check_unused_services() {
    echo -e "${BLUE}üîç –ü–æ–∏—Å–∫ –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤...${NC}"
    {
        echo -e "\n=== –ù–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å–µ—Ä–≤–∏—Å—ã ===\n"
        systemctl list-unit-files --state=enabled | grep -Ev "(static|indirect)" || echo "–ù–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å–µ—Ä–≤–∏—Å—ã –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω—ã"
    } >> "$AUDIT_REPORT"
}

check_obsolete_packages() {
    echo -e "${BLUE}üîç –ü–æ–∏—Å–∫ —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö –ø–∞–∫–µ—Ç–æ–≤...${NC}"
    {
        echo -e "\n=== –£—Å—Ç–∞—Ä–µ–≤—à–∏–µ –ø–∞–∫–µ—Ç—ã ===\n"
        pacman -Qm || echo "–£—Å—Ç–∞—Ä–µ–≤—à–∏–µ –ø–∞–∫–µ—Ç—ã –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω—ã"
    } >> "$AUDIT_REPORT"
}

check_unused_packages() {
    echo -e "${BLUE}üîç –ü–æ–∏—Å–∫ –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –ø–∞–∫–µ—Ç–æ–≤...${NC}"
    {
        echo -e "\n=== –ù–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –ø–∞–∫–µ—Ç—ã ===\n"
        pacman -Qtdq || echo "–ù–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –ø–∞–∫–µ—Ç—ã –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω—ã"
    } >> "$AUDIT_REPORT"
}

check_unsafe_env_vars() {
    echo -e "${BLUE}üîç –ü–æ–∏—Å–∫ –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è...${NC}"
    {
        echo -e "\n=== –ù–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è ===\n"
        env | grep -Ei "(LD_PRELOAD|LD_LIBRARY_PATH)" || echo "–ù–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω—ã"
    } >> "$AUDIT_REPORT"
}

check_unsafe_cron_jobs() {
    echo -e "${BLUE}üîç –ü–æ–∏—Å–∫ –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã—Ö cron-–∑–∞–¥–∞–Ω–∏–π...${NC}"
    {
        echo -e "\n=== –ù–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã–µ cron-–∑–∞–¥–∞–Ω–∏—è ===\n"
        find /etc/cron* -type f -exec grep -Hv "^#" {} \; | grep -Ei "(wget|curl|sh -c)" || echo "–ù–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã–µ cron-–∑–∞–¥–∞–Ω–∏—è –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω—ã"
    } >> "$AUDIT_REPORT"
}

run_lynis_audit() {
    if command -v lynis &>/dev/null; then
        echo -e "${BLUE}üîç –ó–∞–ø—É—Å–∫ –∫–æ–º–ø–ª–µ–∫—Å–Ω–æ–≥–æ –∞—É–¥–∏—Ç–∞ (lynis)...${NC}"
        {
            echo -e "\n=== –ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–π –∞—É–¥–∏—Ç (lynis) ===\n"
            lynis audit system --quick --no-colors
        } >> "$AUDIT_REPORT"
    } else
        echo -e "${YELLOW}‚ö† lynis –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –∫–æ–º–ø–ª–µ–∫—Å–Ω—ã–π –∞—É–¥–∏—Ç${NC}" >> "$AUDIT_REPORT"
    fi
}

# –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π —Ä–µ–∂–∏–º –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è
interactive_mode() {
    echo -e "${BLUE}üîç –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π —Ä–µ–∂–∏–º –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è:${NC}"
    select action in "–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã" "–û—á–∏—Å—Ç–∫–∞ —Å–∏—Å—Ç–µ–º—ã" "–ê—É–¥–∏—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏" "–†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –∞—É–¥–∏—Ç" "–í—ã—Ö–æ–¥"; do
        case $action in
            "–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã")
                system_upgrade
                extra_update_maintenance
                ;;
            "–û—á–∏—Å—Ç–∫–∞ —Å–∏—Å—Ç–µ–º—ã")
                clean_system
                ;;
            "–ê—É–¥–∏—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏")
                security_check
                ;;
            "–†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –∞—É–¥–∏—Ç")
                extended_audit
                ;;
            "–í—ã—Ö–æ–¥")
                break
                ;;
            *)
                echo -e "${RED}‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –≤—ã–±–æ—Ä${NC}" ;;
        esac
    done
}

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∏—Å—Ç—Ä–∏–±—É—Ç–∏–≤–∞
check_distro() {
    if [[ -f /etc/arch-release ]]; then
        echo "Arch Linux"
    elif [[ -f /etc/debian_version ]]; then
        echo "Debian/Ubuntu"
    else
        echo "Unknown"
    fi
}

# –§—É–Ω–∫—Ü–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–æ–ª–Ω–æ–≥–æ –æ—Ç—á–µ—Ç–∞ (–ª–æ–≥ + –∞—É–¥–∏—Ç) –≤ –æ–¥–∏–Ω TXT-—Ñ–∞–π–ª —Å –¥–∞—Ç–æ–π –∏ –≤—Ä–µ–º–µ–Ω–µ–º
save_full_report() {
    local final_report="${LOGDIR}/full_report_${TIMESTAMP}.txt"
    {
        echo "=== FULL REPORT: $(date) ==="
        echo -e "\n=== Maintenance Log ===\n"
        cat "$LOGFILE"
        echo -e "\n=== Audit Report ===\n"
        cat "$AUDIT_REPORT"
    } > "$final_report"
    echo -e "${GREEN}–ü–æ–ª–Ω—ã–π –æ—Ç—á–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω –≤: ${final_report}${NC}"
}

# –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞
main "$@"

echo -e "\n${GREEN}‚úÖ –û–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω–æ: $(date)${NC}"
echo -e "‚óè –õ–æ–≥–∏: ${BLUE}${LOGFILE}${NC}"
echo -e "‚óè –û—Ç—á–µ—Ç: ${BLUE}${AUDIT_REPORT}${NC}"
echo -e "‚óè –ü–æ–ª–Ω—ã–π –æ—Ç—á–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω –≤: ${BLUE}${LOGDIR}/full_report_${TIMESTAMP}.txt${NC}"
echo -e "‚óè –ö—Ä–∏—Ç–∏—á–Ω—ã–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è:"
grep --color=auto -iP 'error|warning|fail' "$LOGFILE" | sort | uniq
